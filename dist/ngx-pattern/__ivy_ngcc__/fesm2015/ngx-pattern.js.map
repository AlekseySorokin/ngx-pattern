{"version":3,"file":"ngx-pattern.js","sources":["../../../projects/ngx-pattern/src/lib/ngx-pattern.directive.ts","../../../projects/ngx-pattern/src/lib/ngx-pattern.module.ts","../../../projects/ngx-pattern/src/public-api.ts","../../../projects/ngx-pattern/src/ngx-pattern.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  Directive,\r\n  ElementRef,\r\n  HostListener,\r\n  Inject,\r\n  Input,\r\n  OnChanges,\r\n  OnDestroy,\r\n  OnInit,\r\n  Optional\r\n} from '@angular/core';\r\nimport { NgControl } from '@angular/forms';\r\n\r\n@Directive({\r\n  selector: '[ngxPattern]'\r\n})\r\nexport class NgxPatternDirective implements OnChanges, OnInit, OnDestroy {\r\n  @Input() ngxPattern: RegExp | string;\r\n\r\n  private regex: RegExp;\r\n  private lastSelectionStart: number;\r\n  private lastSelectionEnd: number;\r\n  private lastValue: string;\r\n  onPasteHandler: (e: ClipboardEvent) => void;\r\n  onKeydownHandler: (e: KeyboardEvent) => void;\r\n\r\n  constructor(@Inject(ElementRef) private host: ElementRef, @Optional() @Inject(NgControl) private control: NgControl) {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.onPasteHandler = (e: ClipboardEvent) => {\r\n      this.onPaste(e);\r\n    };\r\n    this.onKeydownHandler = (e: KeyboardEvent) => {\r\n      this.onKeyDown(e);\r\n    };\r\n    this.host.nativeElement.addEventListener('keydown', this.onKeydownHandler);\r\n    this.host.nativeElement.addEventListener('paste', this.onPasteHandler);\r\n  }\r\n\r\n  ngOnChanges(): void {\r\n    if (this.ngxPattern) {\r\n      if (typeof this.ngxPattern === 'string') {\r\n        this.regex = new RegExp(`^${this.ngxPattern}$`, 'g');\r\n      } else {\r\n        this.regex = this.ngxPattern;\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.host.nativeElement.removeEventListener('keydown', this.onKeydownHandler);\r\n    this.host.nativeElement.removeEventListener('paste', this.onPasteHandler);\r\n  }\r\n\r\n  private onKeyDown(e?: KeyboardEvent): void {\r\n    const input = e?.currentTarget as HTMLInputElement;\r\n    this.lastValue = input.value || '';\r\n    const {\r\n      selectionStart,\r\n      selectionEnd,\r\n    } = this.inputEl;\r\n    if (selectionStart !== null) {\r\n      this.lastSelectionStart = selectionStart;\r\n    }\r\n    if (selectionEnd !== null) {\r\n      this.lastSelectionEnd = selectionEnd;\r\n    }\r\n    if (this.regex && e && !e.ctrlKey && !e.metaKey && !isSpecialKey(e.key)) {\r\n      if (!this.validWithChange(e.key)) {\r\n        e.preventDefault();\r\n      }\r\n    }\r\n  }\r\n\r\n  @HostListener('input', [])\r\n  onInput(): void {\r\n    if (this.currentValue && !this.textIsValid(this.currentValue)) {\r\n      // Mobile browsers don't support keydown preventDefault and return\r\n      // Unidentified for the pressed key. We need to detect the change on input event and undo.\r\n      document.execCommand('undo');\r\n    }\r\n  }\r\n\r\n  private onPaste(e?: ClipboardEvent): void {\r\n    const pastedInput = e?.clipboardData?.getData('text/plain');\r\n    if (pastedInput) {\r\n      e?.preventDefault();\r\n      if (this.validWithChange(pastedInput)) {\r\n        const text = this.lastValue.substring(0, this.lastSelectionStart) + pastedInput + this.lastValue.substring(this.lastSelectionEnd);\r\n        if (this.control) {\r\n          this.control.control?.setValue(text);\r\n        } else {\r\n          this.inputEl.value = text;\r\n        }\r\n        this.inputEl.setSelectionRange(this.lastSelectionEnd + pastedInput.length, this.lastSelectionStart + pastedInput.length);\r\n      }\r\n    }\r\n  }\r\n\r\n  @HostListener('drop', ['$event'])\r\n  onDrop(e: DragEvent): void {\r\n    const textData = e.dataTransfer?.getData('text');\r\n\r\n    if (textData && !this.validWithChange(textData)) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  get currentValue(): string | undefined {\r\n    return this.inputEl ? this.inputEl.value : undefined;\r\n  }\r\n\r\n  private validWithChange(delta: string): boolean {\r\n    const {\r\n      value: current,\r\n      selectionStart,\r\n      selectionEnd,\r\n    } = this.inputEl;\r\n    if (selectionEnd === null || selectionStart === null) {\r\n      return false;\r\n    }\r\n    const updated = current.substring(0, selectionStart) + delta + current.substring(selectionEnd + 1);\r\n    return this.textIsValid(updated);\r\n  }\r\n\r\n  private textIsValid(text: string): boolean {\r\n    const result = !text || this.regex.test(text);\r\n    this.regex.lastIndex = 0;\r\n\r\n    return result;\r\n  }\r\n\r\n  get inputEl(): HTMLInputElement {\r\n    return this.host.nativeElement;\r\n  }\r\n}\r\n\r\n/** @see https://developer.mozilla.org/bg/docs/Web/API/KeyboardEvent/key/Key_Values */\r\nfunction isSpecialKey(key: string): boolean {\r\n  return key.length > 1;\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { NgxPatternDirective } from './ngx-pattern.directive';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\n@NgModule({\r\n  declarations: [NgxPatternDirective],\r\n  imports: [\r\n    FormsModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  exports: [\r\n    NgxPatternDirective\r\n  ]\r\n})\r\nexport class NgxPatternModule {\r\n}\r\n","/*\r\n * Public API Surface of ngx-pattern\r\n */\r\n\r\nexport * from './lib/ngx-pattern.directive';\r\nexport * from './lib/ngx-pattern.module';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"]}